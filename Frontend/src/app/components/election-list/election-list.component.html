<div class="election-list-container">
  <!-- Header -->
  <div class="page-header">
    <h1>
      <mat-icon>ballot</mat-icon>
      Të Gjitha Zgjedhjet
    </h1>
    <p class="subtitle">Eksploroni dhe merrni pjesë në zgjedhjet e disponueshme</p>
  </div>

  <!-- Filters and Controls -->
  <mat-card class="filters-card">
    <div class="filters-container">
      <!-- Search -->
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Kërko zgjedhje</mat-label>
        <input matInput [(ngModel)]="searchTerm" (input)="onSearchChange()" placeholder="Emri ose përshkrimi...">
        <mat-icon matPrefix>search</mat-icon>
        <button mat-icon-button matSuffix *ngIf="searchTerm" (click)="searchTerm=''; onSearchChange()">
          <mat-icon>clear</mat-icon>
        </button>
      </mat-form-field>

      <!-- Status Filter -->
      <div class="filter-chips">
        <mat-chip-listbox>
          <mat-chip-option [selected]="filterStatus === 'all'" (click)="onFilterChange('all')">
            <mat-icon>all_inclusive</mat-icon>
            Të Gjitha
          </mat-chip-option>
          <mat-chip-option [selected]="filterStatus === 'active'" (click)="onFilterChange('active')" color="primary">
            <mat-icon>play_circle</mat-icon>
            Aktive
          </mat-chip-option>
          <mat-chip-option [selected]="filterStatus === 'upcoming'" (click)="onFilterChange('upcoming')" color="accent">
            <mat-icon>schedule</mat-icon>
            Të Ardhshme
          </mat-chip-option>
          <mat-chip-option [selected]="filterStatus === 'ended'" (click)="onFilterChange('ended')" color="warn">
            <mat-icon>check_circle</mat-icon>
            Përfunduara
          </mat-chip-option>
        </mat-chip-listbox>
      </div>

      <!-- Sort Options -->
      <mat-form-field appearance="outline" class="sort-field">
        <mat-label>Rendit sipas</mat-label>
        <mat-select [(value)]="sortBy" (selectionChange)="applyFilters()">
          <mat-option value="newest">Më të Rejat</mat-option>
          <mat-option value="oldest">Më të Vjetrat</mat-option>
          <mat-option value="name">Emri (A-Z)</mat-option>
          <mat-option value="votes">Më të Votuarat</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- View Toggle -->
      <button mat-icon-button (click)="toggleViewMode()" matTooltip="Ndrysho pamjen">
        <mat-icon>{{ viewMode === 'grid' ? 'view_list' : 'view_module' }}</mat-icon>
      </button>

      <!-- Refresh -->
      <button mat-icon-button (click)="loadElections()" matTooltip="Rifresko">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
  </mat-card>

  <!-- Results Count -->
  <div class="results-count" *ngIf="!loading">
    <span>Duke shfaqur <strong>{{ filteredElections.length }}</strong> nga {{ elections.length }} zgjedhje</span>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <mat-spinner></mat-spinner>
    <p>Duke ngarkuar zgjedhjet...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && filteredElections.length === 0" class="empty-state">
    <mat-icon>search_off</mat-icon>
    <h3>Nuk u gjetën zgjedhje</h3>
    <p>Provoni të ndryshoni filtrat ose kriteret e kërkimit</p>
    <button mat-raised-button color="primary" (click)="searchTerm=''; filterStatus='all'; applyFilters()">
      Pastro Filtrat
    </button>
  </div>

  <!-- Grid View -->
  <div class="elections-grid" *ngIf="!loading && filteredElections.length > 0 && viewMode === 'grid'">
    <mat-card *ngFor="let election of filteredElections" class="election-card" (click)="viewElection(election)">
      <div class="election-status-badge">
        <mat-chip [color]="getStatusColor(election)" selected>
          {{ getElectionStatus(election) }}
        </mat-chip>
      </div>

      <mat-card-header>
        <mat-card-title>{{ election.name }}</mat-card-title>
        <mat-card-subtitle>ID: #{{ election.id }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <p class="description">{{ election.description }}</p>
        
        <div class="election-stats">
          <div class="stat-item">
            <mat-icon>people</mat-icon>
            <div>
              <span class="stat-value">{{ election.candidateCount }}</span>
              <span class="stat-label">Kandidatë</span>
            </div>
          </div>
          <div class="stat-item">
            <mat-icon>how_to_vote</mat-icon>
            <div>
              <span class="stat-value">{{ election.totalVotes }}</span>
              <span class="stat-label">Vota</span>
            </div>
          </div>
        </div>

        <mat-divider></mat-divider>

        <div class="time-info">
          <mat-icon>schedule</mat-icon>
          <span>{{ getTimeInfo(election) }}</span>
        </div>

        <mat-progress-bar 
          mode="determinate" 
          [value]="getElectionProgress(election)"
          [color]="getStatusColor(election)">
        </mat-progress-bar>

        <div class="date-range">
          <small>{{ formatDate(election.startTime) }} - {{ formatDate(election.endTime) }}</small>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button color="primary" (click)="$event.stopPropagation(); viewResults(election)">
          <mat-icon>bar_chart</mat-icon>
          Rezultatet
        </button>
        <button mat-raised-button color="primary" 
                (click)="$event.stopPropagation(); voteInElection(election)"
                [disabled]="!votingService.isElectionActive(election)">
          <mat-icon>ballot</mat-icon>
          Voto
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- List View -->
  <mat-card class="list-view-container" *ngIf="!loading && filteredElections.length > 0 && viewMode === 'list'">
    <table mat-table [dataSource]="filteredElections" class="elections-table">
      
      <!-- ID Column -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let election">#{{ election.id }}</td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Emri</th>
        <td mat-cell *matCellDef="let election">
          <div class="name-cell">
            <strong>{{ election.name }}</strong>
            <small>{{ election.description }}</small>
          </div>
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Statusi</th>
        <td mat-cell *matCellDef="let election">
          <mat-chip [color]="getStatusColor(election)" selected>
            {{ getElectionStatus(election) }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Candidates Column -->
      <ng-container matColumnDef="candidates">
        <th mat-header-cell *matHeaderCellDef>Kandidatë</th>
        <td mat-cell *matCellDef="let election">{{ election.candidateCount }}</td>
      </ng-container>

      <!-- Votes Column -->
      <ng-container matColumnDef="votes">
        <th mat-header-cell *matHeaderCellDef>Vota</th>
        <td mat-cell *matCellDef="let election">{{ election.totalVotes }}</td>
      </ng-container>

      <!-- Time Column -->
      <ng-container matColumnDef="time">
        <th mat-header-cell *matHeaderCellDef>Koha</th>
        <td mat-cell *matCellDef="let election">{{ getTimeInfo(election) }}</td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Veprime</th>
        <td mat-cell *matCellDef="let election">
          <button mat-icon-button color="primary" (click)="viewElection(election)" matTooltip="Detajet">
            <mat-icon>visibility</mat-icon>
          </button>
          <button mat-icon-button color="accent" (click)="viewResults(election)" matTooltip="Rezultatet">
            <mat-icon>bar_chart</mat-icon>
          </button>
          <button mat-icon-button color="primary" 
                  (click)="voteInElection(election)" 
                  [disabled]="!votingService.isElectionActive(election)"
                  matTooltip="Voto">
            <mat-icon>how_to_vote</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['id', 'name', 'status', 'candidates', 'votes', 'time', 'actions']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['id', 'name', 'status', 'candidates', 'votes', 'time', 'actions'];" 
          class="election-row"></tr>
    </table>
  </mat-card>
</div>