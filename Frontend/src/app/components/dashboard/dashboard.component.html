<div class="dashboard-container">
  <!-- Header -->
  <mat-toolbar color="primary">
    <mat-toolbar-row>
      <mat-icon>dashboard</mat-icon>
      <span class="toolbar-title">Dashboard i Votuesit</span>
      <span class="spacer"></span>
      <span class="user-address">{{ userAddress | slice:0:6 }}...{{ userAddress | slice:-4 }}</span>
      <button mat-button routerLink="/elections">
        <mat-icon>list</mat-icon>
        Të Gjitha
      </button>
      <button mat-icon-button (click)="refresh()">
        <mat-icon>refresh</mat-icon>
      </button>
      <button mat-button (click)="logout()">
        <mat-icon>logout</mat-icon>
        Dalje
      </button>
    </mat-toolbar-row>
  </mat-toolbar>

  <!-- Stats Section -->
  <div class="stats-section">
    <mat-card class="stat-card">
      <mat-card-content>
        <mat-icon color="primary">ballot</mat-icon>
        <div class="stat-info">
          <span class="stat-label">Totali Zgjedhjeve</span>
          <span class="stat-value">{{ stats.totalElections }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card highlight">
      <mat-card-content>
        <mat-icon color="accent">how_to_reg</mat-icon>
        <div class="stat-info">
          <span class="stat-label">I Regjistruar</span>
          <span class="stat-value">{{ stats.eligibleElections }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <mat-icon color="primary">done_all</mat-icon>
        <div class="stat-info">
          <span class="stat-label">Kam Votuar</span>
          <span class="stat-value">{{ stats.votedElections }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <mat-icon color="warn">access_time</mat-icon>
        <div class="stat-info">
          <span class="stat-label">Aktive Tani</span>
          <span class="stat-value">{{ stats.activeNow }}</span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <mat-tab-group [(selectedIndex)]="selectedTab" animationDuration="300ms">
      <!-- My Elections Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">how_to_vote</mat-icon>
          Zgjedhjet e Mia
          <span matBadge="{{ myElections.length }}" matBadgeColor="accent">`</span>
        </ng-template>

        <div class="tab-content">
          <div *ngIf="loading" class="loading-state">
            <mat-spinner></mat-spinner>
            <p>Duke ngarkuar...</p>
          </div>

          <div *ngIf="!loading && myElections.length === 0" class="empty-state">
            <mat-icon>inbox</mat-icon>
            <h3>Nuk jeni i regjistruar në asnjë zgjedhje</h3>
            <p>Kontaktoni administratorin për t'u regjistruar</p>
          </div>

          <div class="elections-grid" *ngIf="!loading && myElections.length > 0">
            <mat-card *ngFor="let election of myElections" class="election-card">
              <mat-card-header>
                <mat-card-title>{{ election.name }}</mat-card-title>
                <mat-card-subtitle>
                  <mat-chip [color]="getStatusColor(election)" selected>
                    {{ getElectionStatus(election) }}
                  </mat-chip>
                </mat-card-subtitle>
              </mat-card-header>
              
              <mat-card-content>
                <p class="description">{{ election.description }}</p>
                
                <div class="election-info">
                  <div class="info-item">
                    <mat-icon>people</mat-icon>
                    <span>{{ election.candidateCount }} kandidatë</span>
                  </div>
                  <div class="info-item">
                    <mat-icon>how_to_vote</mat-icon>
                    <span>{{ election.totalVotes }} vota</span>
                  </div>
                  <div class="info-item">
                    <mat-icon>schedule</mat-icon>
                    <span>{{ getTimeRemaining(election) }}</span>
                  </div>
                </div>

                <mat-progress-bar 
                  mode="determinate" 
                  [value]="getElectionProgress(election)"
                  [color]="getStatusColor(election)">
                </mat-progress-bar>

                <div class="voter-status" *ngIf="election.voterStatus">
                  <mat-chip>
                    <mat-chip color="primary" selected *ngIf="election.voterStatus.eligible">
                      <mat-icon>check_circle</mat-icon>
                      I Regjistruar
                    </mat-chip>
                    <mat-chip color="accent" selected *ngIf="election.voterStatus.hasVoted">
                      <mat-icon>done_all</mat-icon>
                      Keni Votuar
                    </mat-chip>
                  </mat-chip>
                </div>
              </mat-card-content>

              <mat-card-actions>
                <button 
                  mat-raised-button 
                  [color]="canVote(election) ? 'primary' : ''"
                  [disabled]="!canVote(election)"
                  (click)="navigateToVote(election)">
                  <mat-icon>ballot</mat-icon>
                  {{ getVoteButtonText(election) }}
                </button>
                <button mat-button (click)="viewResults(election)">
                  <mat-icon>bar_chart</mat-icon>
                  Rezultatet
                </button>
                <button mat-button (click)="viewDetails(election)">
                  <mat-icon>info</mat-icon>
                  Detajet
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <!-- Active Elections Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">play_circle</mat-icon>
          Aktive
          <span matBadge="{{ activeElections.length }}" matBadgeColor="warn"></span>
        </ng-template>

        <div class="tab-content">
          <div *ngIf="activeElections.length === 0" class="empty-state">
            <mat-icon>pause_circle</mat-icon>
            <h3>Nuk ka zgjedhje aktive</h3>
            <p>Kontrolloni më vonë për zgjedhje të reja</p>
          </div>

          <div class="elections-grid" *ngIf="activeElections.length > 0">
            <mat-card *ngFor="let election of activeElections" class="election-card active">
              <div class="live-badge">
                <span class="pulse"></span>
                LIVE
              </div>
              
              <mat-card-header>
                <mat-card-title>{{ election.name }}</mat-card-title>
                <mat-card-subtitle>Aktive deri: {{ formatDate(election.endTime) }}</mat-card-subtitle>
              </mat-card-header>
              
              <mat-card-content>
                <p class="description">{{ election.description }}</p>
                
                <div class="election-stats">
                  <div class="stat">
                    <strong>{{ election.candidateCount }}</strong>
                    <span>Kandidatë</span>
                  </div>
                  <div class="stat">
                    <strong>{{ election.totalVotes }}</strong>
                    <span>Vota</span>
                  </div>
                  <div class="stat">
                    <strong>{{ getTimeRemaining(election) }}</strong>
                    <span>Mbetur</span>
                  </div>
                </div>

                <mat-progress-bar 
                  mode="determinate" 
                  [value]="getElectionProgress(election)"
                  color="warn">
                </mat-progress-bar>
              </mat-card-content>

              <mat-card-actions>
                <button mat-raised-button color="warn" (click)="viewResults(election)">
                  <mat-icon>trending_up</mat-icon>
                  Shiko Live
                </button>
                <button mat-button (click)="viewDetails(election)">
                  Detajet
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <!-- Upcoming Elections Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">event</mat-icon>
          Të Ardhshme
          <span matBadge="{{ upcomingElections.length }}"></span>
        </ng-template>

        <div class="tab-content">
          <div *ngIf="upcomingElections.length === 0" class="empty-state">
            <mat-icon>event_busy</mat-icon>
            <h3>Nuk ka zgjedhje të planifikuara</h3>
          </div>

          <div class="elections-list" *ngIf="upcomingElections.length > 0">
            <mat-card *ngFor="let election of upcomingElections" class="upcoming-card">
              <mat-card-header>
                <mat-card-title>{{ election.name }}</mat-card-title>
                <mat-card-subtitle>
                  <mat-icon inline>schedule</mat-icon>
                  Fillon: {{ formatDate(election.startTime) }}
                </mat-card-subtitle>
              </mat-card-header>
              
              <mat-card-content>
                <p>{{ election.description }}</p>
                <div class="countdown">
                  <mat-icon color="accent">timer</mat-icon>
                  <span>{{ getTimeRemaining(election) }}</span>
                </div>
              </mat-card-content>

              <mat-card-actions>
                <button mat-button color="primary" (click)="viewDetails(election)">
                  Më shumë informacion
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <!-- Ended Elections Tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">history</mat-icon>
          Të Përfunduara
          <span matBadge="{{ endedElections.length }}"></span>
        </ng-template>

        <div class="tab-content">
          <div *ngIf="endedElections.length === 0" class="empty-state">
            <mat-icon>history</mat-icon>
            <h3>Nuk ka zgjedhje të përfunduara</h3>
          </div>

          <div class="elections-list" *ngIf="endedElections.length > 0">
            <mat-card *ngFor="let election of endedElections" class="ended-card">
              <mat-card-header>
                <mat-card-title>{{ election.name }}</mat-card-title>
                <mat-card-subtitle>
                  Përfundoi: {{ formatDate(election.endTime) }}
                </mat-card-subtitle>
              </mat-card-header>
              
              <mat-card-content>
                <p>{{ election.description }}</p>
                <div class="final-stats">
                  <span><strong>{{ election.totalVotes }}</strong> vota totale</span>
                  <span><strong>{{ election.candidateCount }}</strong> kandidatë</span>
                </div>
              </mat-card-content>

              <mat-card-actions>
                <button mat-raised-button (click)="viewResults(election)">
                  <mat-icon>assessment</mat-icon>
                  Rezultatet Finale
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>